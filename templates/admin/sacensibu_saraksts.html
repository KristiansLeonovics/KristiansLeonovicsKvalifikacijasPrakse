<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="static/amainpage.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <title>Horsify sacensību saraksts</title>
</head>

<style>
  body {
    background-image: url("/static/1.jpg");
    background-size: cover;
  }
</style>

<body>
  {% extends 'layout.html' %}

  {% block content %}

  <div class="container text-center">
    <div class="row">
      <div class="col possition_control">
        <div class="card">
          <div class="card-header">
            <h4>Labot Sacensību Datus</h4>
          </div>
          <div class="card-body">
            <form action="{{ url_for('sacensibas_labot') }}" method="post">
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">nosaukums</label>
                <input type="text" name="nosaukums" placeholder="Ievadiet sacensības nosaukumu" id="nosaukums" class="form-control" aria-describedby="emailHelp" required>
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Jaunais Nosaukums</label>
                <input type="text" name="jaunais_nosaukums" placeholder="Ievadiet sacensības jauno nosaukumu" id="jaunais_nosaukums" class="form-control" aria-describedby="emailHelp">
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Atrašanās vieta</label>
                <input type="text" name="atrasanasvieta" placeholder="Ievadiet sacensības jauno atrašanās vietu" id="atrasanasvieta" class="form-control" aria-describedby="emailHelp">
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Sākuma Datums</label>
                <input type="text" name="datums_sakums" placeholder="Ievadiet sacensības jauno datumu, kad sākas sacensības" id="datums_sakums" class="form-control" aria-describedby="emailHelp">
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Beigu Datums</label>
                <input type="text" name="datums_beigas" placeholder="Ievadiet sacensības jauno datumu, kad beidzas sacensības" id="datums_beigas" class="form-control" aria-describedby="emailHelp">
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Jāšanas Norises Vieta</label>
                <input type="text" name="jasanas_norises_vieta" placeholder="Ievadiet sacensības jauno jāšanas sacensības norises vietu (Latvija vai Ārzemes)" id="jasanas_norises_vieta" class="form-control" aria-describedby="emailHelp">
              </div>

              <button type="submit" value="edit" class="btn btn-primary">Labot sacensību</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col possition_control">
        <div class="card">
          <div class="card-header">
            <h4>Pievienot Jaunu Sacensību Datubāzē</h4>
          </div>
          <div class="card-body">
            <form action="{{ url_for('sacensibas_pievienot') }}" method="post">
              <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Nosaukums</label>
            <input type="text" name="nosaukums" placeholder="Ievadiet jaunās sacensības nosaukumu" id="nosaukums" class="form-control" aria-describedby="emailHelp" required >
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Atrašanās vieta</label>
            <input type="text" name="atrasanasvieta" placeholder="Ievadiet jaunās sacensības atrašanās vietu" id="atrasanasvieta" class="form-control" aria-describedby="emailHelp" required >
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Sākuma datums</label>
            <input type="text" name="datums_sakums" placeholder="Ievadiet jaunās sacensības datumu, kad sākas sacensības" id="datums_sakums" class="form-control" aria-describedby="emailHelp" required >
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Beigu datums</label>
            <input type="text" name="datums_beigas" placeholder="Ievadiet jaunās sacensības datumu, kad beidzas sacensības" id="datums_beigas" class="form-control" aria-describedby="emailHelp" required >
          </div>
          <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Jāšanas norises vieta</label>
            <input type="text" name="jasanas_norises_vieta" placeholder="Ievadiet jaunās sacensības jāšanas sacensības norises vietu, kad beidzas sacensības" id="jasanas_norises_vieta" class="form-control" aria-describedby="emailHelp" required >
          </div>

              <button type="submit" value="add" class="btn btn-success">Pievienot Sacensību</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col possition_control">
        <div class="card">
          <div class="card-header">
            <h4>Sacensību dzēšana</h4>
          </div>
          <div class="card-body">
            <form action="{{ url_for('sacensibas_dzest') }}" method="post">
              <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Nosaukums</label>
            <input type="text" name="nosaukums" placeholder="ievadiet sacensības nosaukumu, kuru vēlaties izdzēst" id="nosaukums" class="form-control" aria-describedby="emailHelp" required >
          </div>
              <button type="submit" value="delete" class="btn btn-danger">Izdzēst sacensību</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <br>

  <div class="container">
    <div class="container-sm">
      <table class="table table-bordered table-striped table-horse-theme" id="table">
          <thead>
            <tr>
              <th>Nosaukums</th>
              <th>Atrašanās vieta</th>
              <th>Sākuma datums</th>
              <th>Beigu datums</th>
              <th>Laiks</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for ieraksts in datubaze %}
            <tr>
              <td>{{ ieraksts.nosaukums }}</td>
              <td>{{ ieraksts.atrasanasvieta }}</td>
              <td>{{ ieraksts.datums_sakums }}</td>
              <td>{{ ieraksts.datums_beigas }}</td>
              <td>{{ ieraksts.laiks }}</td>
              <td>
                <a href="{{ url_for('sacensibas_labot', nosaukums=ieraksts.nosaukums) }}" class="btn btn-primary btn-sm">Labot</a>
                <a href="{{ url_for('sacensibas_dzest', nosaukums=ieraksts.nosaukums) }}" class="btn btn-danger btn-sm">Dzēst</a>
              </td>
            </tr>
            <tr id="edit-row-{{ ieraksts.nosaukums }}" style="display: none;">
              <td><input type="text" name="edit-nosaukums" value="{{ ieraksts.nosaukums }}" class="form-control"></td>
              <td><input type="text" name="edit-atrasanasvieta" value="{{ ieraksts.atrasanasvieta }}" class="form-control"></td>
              <td><input type="text" name="edit-datums_sakums" value="{{ ieraksts.datums_sakums }}" class="form-control"></td>
              <td><input type="text" name="edit-datums_beigas" value="{{ ieraksts.datums_beigas }}" class="form-control"></td>
              <td><input type="text" name="edit-laiks" value="{{ ieraksts.laiks }}" class="form-control"></td>
              <td>
                <button class="btn btn-primary btn-sm" onclick="saveRow('{{ ieraksts.nosaukums }}')">Save</button>
                <button class="btn btn-secondary btn-sm" onclick="dismissChanges('{{ ieraksts.nosaukums }}')">Dismiss Changes</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        </tbody>
      </table>
      <div class="text-center mt-3">
        <a class="btn btn-primary" href="{{ url_for('PDF_dokuments_sacensibas') }}" target="_blank">Print as PDF</a>
      </div>      
    </div>
  </div>

  <script>
    function editRow(nosaukums) {
      var row = document.getElementById('edit-row-' + nosaukums);
      var inputs = row.getElementsByTagName('input');
      for (var i = 0; i < inputs.length; i++) {
        inputs[i].disabled = false;
      }
      row.getElementsByClassName('btn-primary')[0].style.display = 'inline-block';
      row.getElementsByClassName('btn-secondary')[0].style.display = 'inline-block';
      row.getElementsByClassName('btn-info')[0].row.getElementsByClassName('btn-info')[0].style.display = 'none';
    }

    function saveRow(nosaukums) {
      var row = document.getElementById('edit-row-' + nosaukums);
      var inputs = row.getElementsByTagName('input');
      var data = {};
      for (var i = 0; i < inputs.length; i++) {
        inputs[i].disabled = true;
        data[inputs[i].name] = inputs[i].value;
      }
      fetch('/sacensibas_labot', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        console.log(data.message);
        row.getElementsByClassName('btn-primary')[0].style.display = 'none';
        row.getElementsByClassName('btn-secondary')[0].style.display = 'none';
        row.getElementsByClassName('btn-info')[0].style.display = 'inline-block';
      });
    }

    function dismissChanges(nosaukums) {
      var row = document.getElementById('edit-row-' + nosaukums);
      var inputs = row.getElementsByTagName('input');
      for (var i = 0; i < inputs.length; i++) {
        inputs[i].disabled = true;
        inputs[i].value = inputs[i].getAttribute('data-value');
      }
      row.getElementsByClassName('btn-primary')[0].style.display = 'none';
      row.getElementsByClassName('btn-secondary')[0].style.display = 'none';
      row.getElementsByClassName('btn-info')[0].style.display = 'inline-block';
    }

    function deleteRow(nosaukums) {
      var row = document.getElementById('edit-row-' + nosaukums);
      var nosaukumsInput = row.getElementsByClassName('nosaukums-input')[0];
      var nosaukums = nosaukumsInput.value;
      fetch('/sacensibas_dzest', {
        method: 'POST',
        body: JSON.stringify({nosaukums: nosaukums}),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        console.log(data.message);
        row.remove();
      });
    }
  </script>
</body>
</html>
  {% endblock %}
